<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mohit AI Translator</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  padding: 20px;
}
.card {
  background: white;
  max-width: 600px;
  margin: auto;
  padding: 20px;
  border-radius: 10px;
}
h2 { text-align: center; }
button {
  padding: 10px 15px;
  margin-top: 10px;
}
progress {
  width: 100%;
  height: 20px;
  margin-top: 10px;
}
.preview {
  background: #eee;
  padding: 10px;
  margin-top: 10px;
  height: 80px;
  overflow-y: auto;
}
.status {
  margin-top: 10px;
  font-size: 14px;
  color: #444;
}
</style>
</head>

<body>

<div class="card">
  <h2>Mohit AI Translator</h2>

  <input type="file" id="fileInput" accept=".docx"><br>
  <button onclick="startUpload()">Upload & Translate</button>

  <div class="status" id="statusText">Waiting…</div>

  <progress id="progressBar" value="0" max="100"></progress>

  <div class="preview" id="previewBox">No content yet</div>

  <a id="downloadLink" style="display:none;margin-top:10px;">Download Hindi DOC</a>
</div>

<script>
const BASE_URL = "https://exam-translate-backen.onrender.com";
let jobId = null;

function startUpload() {
  const fileInput = document.getElementById("fileInput");
  const status = document.getElementById("statusText");

  if (!fileInput.files.length) {
    alert("Please choose a DOCX file first");
    return;
  }

  const formData = new FormData();
  formData.append("file", fileInput.files[0]);

  status.innerText = "Uploading file…";

  fetch(`${BASE_URL}/upload`, {
    method: "POST",
    body: formData
  })
  .then(res => res.json())
  .then(data => {
    if (data.error) {
      status.innerText = "ERROR: " + data.error;
      return;
    }
    jobId = data.job_id;
    status.innerText = "Processing started…";
    pollStatus();
  })
  .catch(err => {
    status.innerText = "UPLOAD FAILED: " + err;
  });
}

function pollStatus() {
  if (!jobId) return;

  fetch(`${BASE_URL}/status/${jobId}`)
  .then(res => res.json())
  .then(data => {
    if (!data.total) {
      setTimeout(pollStatus, 1000);
      return;
    }

    const percent = Math.round((data.current / data.total) * 100);
    document.getElementById("progressBar").value = percent;
    document.getElementById("statusText").innerText =
      `Processing ${data.current} / ${data.total}`;
    document.getElementById("previewBox").innerText =
      data.line || "";

    if (data.done) {
      const link = document.getElementById("downloadLink");
      link.href = `${BASE_URL}/download/${jobId}`;
      link.innerText = "Download Hindi DOC";
      link.style.display = "block";
      document.getElementById("statusText").innerText = "Completed ✔";
    } else {
      setTimeout(pollStatus, 1000);
    }
  })
  .catch(err => {
    document.getElementById("statusText").innerText =
      "STATUS ERROR: " + err;
  });
}
</script>

</body>
</html>
